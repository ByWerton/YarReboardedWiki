<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yar Reboarded Wiki</title>
<style>
body { margin:0; font-family:sans-serif; background:#f0f0f0; }
header { background:#333; color:white; padding:1rem; text-align:center; }
#loginSection, #mainSection { display:none; }
input, button, textarea { padding:0.5rem; margin:0.2rem 0; }
.container { display:flex; }
.menu { width:200px; background:#222; color:white; min-height:90vh; padding:1rem; }
.menu button { display:block; width:100%; margin-bottom:0.5rem; cursor:pointer; }
.content { flex:1; padding:1rem; }
.block, .map, .cargo { border:1px solid #999; padding:1rem; margin:1rem 0; background:white; }
.admin { background:#ffcccc; padding:0.5rem; margin:0.5rem 0; }
img { max-width:100px; display:block; margin-bottom:0.5rem; }
textarea { width:100%; }
</style>
</head>
<body>

<header>
  <h1>Yar Reboarded Wiki</h1>
</header>

<div id="loginSection">
  <h2>Giriş / Kayıt</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Şifre"><br>
  <button onclick="login()">Giriş Yap</button>
  <button onclick="signup()">Kayıt Ol</button>
  <p id="loginMsg"></p>
</div>

<div id="mainSection">
  <div class="container">
    <div class="menu">
      <button onclick="showSection('home')">Anasayfa</button>
      <button onclick="showSection('cargo')">Kargolar</button>
      <button onclick="showSection('blocks')">Blocklar</button>
      <button onclick="showSection('maps')">Mapler</button>
      <button onclick="showSection('comments')">Yorumlar</button>
      <button onclick="logout()">Çıkış</button>
    </div>
    <div class="content">
      <div id="home"><h2>Hoşgeldiniz</h2></div>

      <div id="cargo" style="display:none;">
        <h2>Kargolar</h2>
        <div id="cargoList"></div>
        <div id="cargoAdmin" class="admin">
          <h3>Yeni Kargo Ekle</h3>
          <input type="text" id="cargoName" placeholder="Kargo Adı"><br>
          <input type="number" id="cargoLife" placeholder="Kargo Canı"><br>
          <input type="number" id="cargoDamage" placeholder="Kargo Hasarı"><br>
          <input type="file" id="cargoImage"><br>
          <textarea id="cargoDesc" placeholder="Açıklama"></textarea><br>
          <button onclick="addCargo()">Ekle</button>
        </div>
      </div>

      <div id="blocks" style="display:none;">
        <h2>Blocklar</h2>
        <div id="blockList"></div>
        <div id="blockAdmin" class="admin">
          <h3>Yeni Block Ekle</h3>
          <input type="text" id="blockName" placeholder="Block Adı"><br>
          <input type="number" id="blockLife" placeholder="Block Canı"><br>
          <input type="number" id="blockDamage" placeholder="Block Hasarı"><br>
          <input type="file" id="blockImage"><br>
          <textarea id="blockDesc" placeholder="Açıklama"></textarea><br>
          <button onclick="addBlock()">Ekle</button>
        </div>
      </div>

      <div id="maps" style="display:none;">
        <h2>Mapler</h2>
        <div id="mapList"></div>
        <div id="mapAdmin" class="admin">
          <h3>Yeni Map Ekle</h3>
          <input type="text" id="mapName" placeholder="Map Adı"><br>
          <input type="file" id="mapImage"><br>
          <textarea id="mapDesc" placeholder="Açıklama"></textarea><br>
          <button onclick="addMap()">Ekle</button>
        </div>
      </div>

      <div id="comments" style="display:none;">
        <h2>Yorumlar</h2>
        <div id="commentList"></div>
        <div id="commentAdmin" class="admin">
          <h3>Yeni Yorum Ekle</h3>
          <textarea id="commentText" placeholder="Yorum"></textarea><br>
          <button onclick="addComment()">Ekle</button>
        </div>
      </div>

    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCcLP7390AotwSTUzZLTOmiglNs1a1OxxU",
  authDomain: "yarreboardedwiki.firebaseapp.com",
  databaseURL: "https://yarreboardedwiki-default-rtdb.firebaseio.com",
  projectId: "yarreboardedwiki",
  storageBucket: "yarreboardedwiki.firebasestorage.app",
  messagingSenderId: "365304875142",
  appId: "1:365304875142:web:5d962e22c249917745a907",
  measurementId: "G-KCDR6CW19E"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const adminEmail = "selimhanlafci121@gmail.com";

function showSection(id){
  document.querySelectorAll('.content > div').forEach(d=>d.style.display='none');
  document.getElementById(id).style.display='block';
}

window.signup = function(){
  const email = document.getElementById('email').value;
  const pass = document.getElementById('password').value;
  createUserWithEmailAndPassword(auth,email,pass).then(()=>{}).catch(e=>alert(e.message));
}

window.login = function(){
  const email = document.getElementById('email').value;
  const pass = document.getElementById('password').value;
  signInWithEmailAndPassword(auth,email,pass).then(()=>{}).catch(e=>alert(e.message));
}

window.logout = function(){
  signOut(auth).then(()=>{ location.reload(); });
}

onAuthStateChanged(auth,user=>{
  if(user){
    document.getElementById('loginSection').style.display='none';
    document.getElementById('mainSection').style.display='block';
    const isAdmin = user.email===adminEmail;
    document.querySelectorAll('.admin').forEach(a=>a.style.display=isAdmin?'block':'none');
    loadAllData();
  } else {
    document.getElementById('loginSection').style.display='block';
    document.getElementById('mainSection').style.display='none';
  }
});

function readFileAsBase64(file, callback){
  if(!file){ callback(''); return; }
  const reader = new FileReader();
  reader.onload = ()=>callback(reader.result);
  reader.readAsDataURL(file);
}

// Kargo
window.addCargo = function(){
  const name = document.getElementById('cargoName').value;
  const life = document.getElementById('cargoLife').value;
  const damage = document.getElementById('cargoDamage').value;
  const imageFile = document.getElementById('cargoImage').files[0];
  const desc = document.getElementById('cargoDesc').value;
  readFileAsBase64(imageFile, img=>{
    push(ref(db,'cargos'),{name,life,damage,img,desc});
    document.getElementById('cargoName').value='';
    document.getElementById('cargoLife').value='';
    document.getElementById('cargoDamage').value='';
    document.getElementById('cargoImage').value='';
    document.getElementById('cargoDesc').value='';
  });
}

// Block
window.addBlock = function(){
  const name = document.getElementById('blockName').value;
  const life = document.getElementById('blockLife').value;
  const damage = document.getElementById('blockDamage').value;
  const imageFile = document.getElementById('blockImage').files[0];
  const desc = document.getElementById('blockDesc').value;
  readFileAsBase64(imageFile,img=>{
    push(ref(db,'blocks'),{name,life,damage,img,desc});
    document.getElementById('blockName').value='';
    document.getElementById('blockLife').value='';
    document.getElementById('blockDamage').value='';
    document.getElementById('blockImage').value='';
    document.getElementById('blockDesc').value='';
  });
}

// Map
window.addMap = function(){
  const name = document.getElementById('mapName').value;
  const imageFile = document.getElementById('mapImage').files[0];
  const desc = document.getElementById('mapDesc').value;
  readFileAsBase64(imageFile,img=>{
    push(ref(db,'maps'),{name,img,desc});
    document.getElementById('mapName').value='';
    document.getElementById('mapImage').value='';
    document.getElementById('mapDesc').value='';
  });
}

// Comment
window.addComment = function(){
  const text = document.getElementById('commentText').value;
  push(ref(db,'comments'),{text});
  document.getElementById('commentText').value='';
}

function loadAllData(){
  // Cargos
  onValue(ref(db,'cargos'),snap=>{
    const container = document.getElementById('cargoList');
    container.innerHTML='';
    snap.forEach(s=>{
      const val = s.val();
      const div = document.createElement('div');
      div.className='cargo';
      div.innerHTML=`<strong>${val.name}</strong><br>Can: ${val.life} Hasar: ${val.damage}<br>${val.desc}<br>${val.img?'<img src="'+val.img+'">':''}`;
      if(auth.currentUser.email===adminEmail){
        const btn = document.createElement('button');
        btn.textContent='Sil';
        btn.onclick=()=>remove(ref(db,'cargos/'+s.key));
        div.appendChild(btn);
      }
      container.appendChild(div);
    });
  });

  // Blocks
  onValue(ref(db,'blocks'),snap=>{
    const container = document.getElementById('blockList');
    container.innerHTML='';
    snap.forEach(s=>{
      const val = s.val();
      const div = document.createElement('div');
      div.className='block';
      div.innerHTML=`<strong>${val.name}</strong><br>Can: ${val.life} Hasar: ${val.damage}<br>${val.desc}<br>${val.img?'<img src="'+val.img+'">':''}`;
      if(auth.currentUser.email===adminEmail){
        const btn = document.createElement('button');
        btn.textContent='Sil';
        btn.onclick=()=>remove(ref(db,'blocks/'+s.key));
        div.appendChild(btn);
      }
      container.appendChild(div);
    });
  });

  // Maps
  onValue(ref(db,'maps'),snap=>{
    const container = document.getElementById('mapList');
    container.innerHTML='';
    snap.forEach(s=>{
      const val = s.val();
      const div = document.createElement('div');
      div.className='map';
      div.innerHTML=`<strong>${val.name}</strong><br>${val.desc}<br>${val.img?'<img src="'+val.img+'">':''}`;
      if(auth.currentUser.email===adminEmail){
        const btn = document.createElement('button');
        btn.textContent='Sil';
        btn.onclick=()=>remove(ref(db,'maps/'+s.key));
        div.appendChild(btn);
      }
      container.appendChild(div);
    });
  });

  // Comments
  onValue(ref(db,'comments'),snap=>{
    const container = document.getElementById('commentList');
    container.innerHTML='';
    snap.forEach(s=>{
      const val = s.val();
      const div = document.createElement('div');
      div.textContent=val.text;
      if(auth.currentUser.email===adminEmail){
        const btn = document.createElement('button');
        btn.textContent='Sil';
        btn.onclick=()=>remove(ref(db,'comments/'+s.key));
        div.appendChild(btn);
      }
      container.appendChild(div);
    });
  });
}
</script>
</body>
</html>
