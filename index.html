<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YarReboarded Wiki</title>
<style>
  /* Basit stil */
  body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; }
  .hidden { display: none; }
  #menu { position: fixed; left: 0; top: 0; width: 200px; height: 100vh; background: #222; color: white; padding: 20px; box-sizing: border-box; }
  #menu button { display: block; margin: 10px 0; width: 100%; padding: 10px; cursor: pointer; background: #444; color: white; border: none; border-radius: 5px; }
  #content { margin-left: 220px; padding: 20px; }
  .block { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; background: white; }
  .admin-btn { background: #d33 !important; }
  img { max-width: 150px; display: block; margin-bottom: 10px; }
  textarea, input { width: 100%; margin-bottom: 5px; padding: 5px; }
</style>
</head>
<body>

<!-- Menü -->
<div id="menu" class="hidden">
  <button onclick="showSection('anasayfa')">Ana Sayfa</button>
  <button onclick="showSection('kargolar')">Kargolar</button>
  <button onclick="showSection('blocklar')">Blocklar</button>
  <button onclick="showSection('map')">Mapler</button>
  <button onclick="showSection('yorumlar')">Yorumlar</button>
  <button onclick="showSection('admin')">Admin Panel</button>
  <button onclick="logout()">Çıkış Yap</button>
</div>

<!-- İçerik -->
<div id="content">
  <!-- Giriş/Kayıt -->
  <div id="auth-section">
    <h2>Giriş Yap</h2>
    <input type="email" id="email" placeholder="E-posta">
    <input type="password" id="password" placeholder="Şifre">
    <button onclick="login()">Giriş Yap</button>
    <button onclick="register()">Kayıt Ol</button>
  </div>

  <!-- Ana Sayfa -->
  <div id="anasayfa" class="hidden">
    <h2>Ana Sayfa</h2>
    <p>Hoşgeldiniz!</p>
  </div>

  <!-- Kargolar -->
  <div id="kargolar" class="hidden">
    <h2>Kargolar</h2>
    <div id="kargo-list"></div>
    <div id="add-kargo" class="hidden">
      <h3>Yeni Kargo Ekle (Admin)</h3>
      <input type="text" id="kargo-ad" placeholder="Kargo Adı">
      <input type="number" id="kargo-can" placeholder="Can">
      <input type="number" id="kargo-hasar" placeholder="Hasar">
      <textarea id="kargo-aciklama" placeholder="Açıklama"></textarea>
      <input type="file" id="kargo-resim">
      <button onclick="addKargo()">Kaydet</button>
    </div>
  </div>

  <!-- Blocklar -->
  <div id="blocklar" class="hidden">
    <h2>Blocklar</h2>
    <div id="block-list"></div>
    <div id="add-block" class="hidden">
      <h3>Yeni Block Ekle (Admin)</h3>
      <input type="text" id="block-ad" placeholder="Block Adı">
      <input type="number" id="block-can" placeholder="Can">
      <input type="number" id="block-hasar" placeholder="Hasar">
      <textarea id="block-aciklama" placeholder="Açıklama"></textarea>
      <input type="file" id="block-resim">
      <button onclick="addBlock()">Kaydet</button>
    </div>
  </div>

  <!-- Map -->
  <div id="map" class="hidden">
    <h2>Mapler</h2>
    <div id="map-list"></div>
    <div id="add-map" class="hidden">
      <h3>Yeni Map Ekle (Admin)</h3>
      <input type="text" id="map-ad" placeholder="Map Adı">
      <textarea id="map-aciklama" placeholder="Açıklama"></textarea>
      <input type="file" id="map-resim">
      <button onclick="addMap()">Kaydet</button>
    </div>
  </div>

  <!-- Yorumlar -->
  <div id="yorumlar" class="hidden">
    <h2>Yorumlar</h2>
    <div id="yorum-list"></div>
    <textarea id="yorum-text" placeholder="Yorum yaz..."></textarea>
    <button onclick="addYorum()">Gönder</button>
  </div>

  <!-- Admin Panel -->
  <div id="admin" class="hidden">
    <h2>Admin Panel</h2>
    <p>Sadece adminler görebilir</p>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCcLP7390AotwSTUzZLTOmiglNs1a1OxxU",
  authDomain: "yarreboardedwiki.firebaseapp.com",
  databaseURL: "https://yarreboardedwiki-default-rtdb.firebaseio.com",
  projectId: "yarreboardedwiki",
  storageBucket: "yarreboardedwiki.firebasestorage.app",
  messagingSenderId: "365304875142",
  appId: "1:365304875142:web:5d962e22c249917745a907",
  measurementId: "G-KCDR6CW19E"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Admin eposta
const adminEmail = "selimhanlafci121@gmail.com";
let isAdmin = false;

function showSection(id) {
  document.querySelectorAll('#content > div').forEach(d => d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function login() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  signInWithEmailAndPassword(auth, email, password)
    .then(userCredential => {
      document.getElementById('auth-section').classList.add('hidden');
      document.getElementById('menu').classList.remove('hidden');
      showSection('anasayfa');
      isAdmin = (email === adminEmail);
      if(isAdmin) {
        document.querySelectorAll('#add-kargo, #add-block, #add-map').forEach(e => e.classList.remove('hidden'));
      }
      loadKargolar();
      loadBlocklar();
      loadMap();
      loadYorumlar();
    })
    .catch(err => alert(err.message));
}

function register() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  createUserWithEmailAndPassword(auth, email, password)
    .then(userCredential => login())
    .catch(err => alert(err.message));
}

function logout() {
  signOut(auth).then(() => {
    location.reload();
  });
}

// --- Kargolar ---
function addKargo() {
  const ad = document.getElementById('kargo-ad').value;
  const can = document.getElementById('kargo-can').value;
  const hasar = document.getElementById('kargo-hasar').value;
  const aciklama = document.getElementById('kargo-aciklama').value;
  const file = document.getElementById('kargo-resim').files[0];
  if(!ad) return alert("Ad boş olamaz");
  if(file) {
    const reader = new FileReader();
    reader.onload = () => {
      saveKargo(ad, can, hasar, aciklama, reader.result);
    };
    reader.readAsDataURL(file);
  } else saveKargo(ad, can, hasar, aciklama, null);
}

function saveKargo(ad, can, hasar, aciklama, resim) {
  const kargoRef = push(ref(db, 'kargolar'));
  set(kargoRef, { ad, can, hasar, aciklama, resim });
}

function loadKargolar() {
  const kargoList = document.getElementById('kargo-list');
  kargoList.innerHTML = '';
  onValue(ref(db, 'kargolar'), snapshot => {
    kargoList.innerHTML = '';
    snapshot.forEach(snap => {
      const data = snap.val();
      const div = document.createElement('div');
      div.classList.add('block');
      if(data.resim) div.innerHTML += `<img src="${data.resim}">`;
      div.innerHTML += `<b>${data.ad}</b> Can: ${data.can} Hasar: ${data.hasar}<br>${data.aciklama}`;
      if(isAdmin) {
        const delBtn = document.createElement('button');
        delBtn.textContent = "Sil";
        delBtn.classList.add('admin-btn');
        delBtn.onclick = () => remove(ref(db,'kargolar/'+snap.key));
        div.appendChild(delBtn);
      }
      kargoList.appendChild(div);
    });
  });
}

// --- Blocklar ---
function addBlock() {
  const ad = document.getElementById('block-ad').value;
  const can = document.getElementById('block-can').value;
  const hasar = document.getElementById('block-hasar').value;
  const aciklama = document.getElementById('block-aciklama').value;
  const file = document.getElementById('block-resim').files[0];
  if(!ad) return alert("Ad boş olamaz");
  if(file) {
    const reader = new FileReader();
    reader.onload = () => saveBlock(ad, can, hasar, aciklama, reader.result);
    reader.readAsDataURL(file);
  } else saveBlock(ad, can, hasar, aciklama, null);
}

function saveBlock(ad, can, hasar, aciklama, resim) {
  const blockRef = push(ref(db, 'blocklar'));
  set(blockRef, { ad, can, hasar, aciklama, resim });
}

function loadBlocklar() {
  const list = document.getElementById('block-list');
  list.innerHTML = '';
  onValue(ref(db, 'blocklar'), snapshot => {
    list.innerHTML = '';
    snapshot.forEach(snap => {
      const data = snap.val();
      const div = document.createElement('div');
      div.classList.add('block');
      if(data.resim) div.innerHTML += `<img src="${data.resim}">`;
      div.innerHTML += `<b>${data.ad}</b> Can: ${data.can} Hasar: ${data.hasar}<br>${data.aciklama}`;
      if(isAdmin) {
        const delBtn = document.createElement('button');
        delBtn.textContent = "Sil";
        delBtn.classList.add('admin-btn');
        delBtn.onclick = () => remove(ref(db,'blocklar/'+snap.key));
        div.appendChild(delBtn);
      }
      list.appendChild(div);
    });
  });
}

// --- Map ---
function addMap() {
  const ad = document.getElementById('map-ad').value;
  const aciklama = document.getElementById('map-aciklama').value;
  const file = document.getElementById('map-resim').files[0];
  if(!ad) return alert("Ad boş olamaz");
  if(file) {
    const reader = new FileReader();
    reader.onload = () => saveMap(ad, aciklama, reader.result);
    reader.readAsDataURL(file);
  } else saveMap(ad, aciklama, null);
}

function saveMap(ad, aciklama, resim) {
  const mapRef = push(ref(db, 'mapler'));
  set(mapRef, { ad, aciklama, resim });
}

function loadMap() {
  const list = document.getElementById('map-list');
  list.innerHTML = '';
  onValue(ref(db, 'mapler'), snapshot => {
    list.innerHTML = '';
    snapshot.forEach(snap => {
      const data = snap.val();
      const div = document.createElement('div');
      div.classList.add('block');
      if(data.resim) div.innerHTML += `<img src="${data.resim}">`;
      div.innerHTML += `<b>${data.ad}</b><br>${data.aciklama}`;
      if(isAdmin) {
        const delBtn = document.createElement('button');
        delBtn.textContent = "Sil";
        delBtn.classList.add('admin-btn');
        delBtn.onclick = () => remove(ref(db,'mapler/'+snap.key));
        div.appendChild(delBtn);
      }
      list.appendChild(div);
    });
  });
}

// --- Yorumlar ---
function addYorum() {
  const text = document.getElementById('yorum-text').value;
  if(!text) return;
  const yorumRef = push(ref(db, 'yorumlar'));
  set(yorumRef, { text });
  document.getElementById('yorum-text').value = '';
}

function loadYorumlar() {
  const list = document.getElementById('yorum-list');
  list.innerHTML = '';
  onValue(ref(db, 'yorumlar'), snapshot => {
    list.innerHTML = '';
    snapshot.forEach(snap => {
      const data = snap.val();
      const div = document.createElement('div');
      div.classList.add('block');
      div.textContent = data.text;
      if(isAdmin) {
        const delBtn = document.createElement('button');
        delBtn.textContent = "Sil";
        delBtn.classList.add('admin-btn');
        delBtn.onclick = () => remove(ref(db,'yorumlar/'+snap.key));
        div.appendChild(delBtn);
      }
      list.appendChild(div);
    });
  });
}

</script>
</body>
</html>
