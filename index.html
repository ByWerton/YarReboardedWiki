<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YarReboarded Wiki</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f0f0; }
  #menu { width:200px; background:#222; color:#fff; position:fixed; top:0; left:0; bottom:0; padding:10px; }
  #menu button { width:100%; margin:5px 0; padding:10px; color:#fff; background:#333; border:none; cursor:pointer; }
  #menu button:hover { background:#555; }
  #content { margin-left:210px; padding:20px; }
  .hidden { display:none; }
  .block, .kargo, .map, .yorum { border:1px solid #ccc; padding:10px; margin:10px 0; background:#fff; }
  .admin-controls { margin-top:5px; }
  input, textarea { width:100%; margin:5px 0; padding:5px; }
  img { max-width:200px; max-height:150px; display:block; margin-top:5px; }
</style>
</head>
<body>

<div id="menu">
  <h3>Menü</h3>
  <button onclick="showSection('anasayfa')">Ana Sayfa</button>
  <button onclick="showSection('kargolar')">Kargolar</button>
  <button onclick="showSection('blocklar')">Blocklar</button>
  <button onclick="showSection('map')">Map</button>
  <button onclick="showSection('yorumlar')">Yorumlar</button>
  <button onclick="showSection('admin')">Admin Panel</button>
  <button onclick="logout()">Çıkış</button>
</div>

<div id="content">
  <div id="giris" class="">
    <h2>Giriş / Kayıt</h2>
    <input type="email" id="email" placeholder="E-posta">
    <input type="password" id="password" placeholder="Şifre">
    <button onclick="login()">Giriş Yap</button>
    <button onclick="signup()">Kayıt Ol</button>
    <p id="girisMessage"></p>
  </div>

  <div id="anasayfa" class="hidden">
    <h2>Ana Sayfa</h2>
    <p>Hoşgeldin <span id="kullaniciEmail"></span></p>
    <p>Burada wiki içeriği gözükecek.</p>
  </div>

  <div id="kargolar" class="hidden">
    <h2>Kargolar</h2>
    <div id="kargoList"></div>
    <div id="kargoForm" class="hidden">
      <input type="text" id="kargoAdi" placeholder="Kargo Adı">
      <input type="number" id="kargoCan" placeholder="Kargo Canı">
      <textarea id="kargoAciklama" placeholder="Açıklama"></textarea>
      <input type="file" id="kargoResim">
      <button onclick="addKargo()">Kaydet</button>
    </div>
  </div>

  <div id="blocklar" class="hidden">
    <h2>Blocklar</h2>
    <div id="blockList"></div>
    <div id="blockForm" class="hidden">
      <input type="text" id="blockAdi" placeholder="Block Adı">
      <input type="number" id="blockCan" placeholder="Block Canı">
      <input type="number" id="blockHasar" placeholder="Block Hasarı">
      <textarea id="blockAciklama" placeholder="Açıklama"></textarea>
      <input type="file" id="blockResim">
      <button onclick="addBlock()">Kaydet</button>
    </div>
  </div>

  <div id="map" class="hidden">
    <h2>Map</h2>
    <div id="mapList"></div>
    <div id="mapForm" class="hidden">
      <input type="text" id="mapAdi" placeholder="Map Adı">
      <textarea id="mapAciklama" placeholder="Açıklama"></textarea>
      <input type="file" id="mapResim">
      <button onclick="addMap()">Kaydet</button>
    </div>
  </div>

  <div id="yorumlar" class="hidden">
    <h2>Yorumlar</h2>
    <div id="yorumList"></div>
    <textarea id="yorumText" placeholder="Yorum Yaz"></textarea>
    <button onclick="addYorum()">Gönder</button>
  </div>

  <div id="admin" class="hidden">
    <h2>Admin Panel</h2>
    <p>Sadece adminler görebilir</p>
    <button onclick="toggleForms()">Formları Göster/Gizle</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCcLP7390AotwSTUzZLTOmiglNs1a1OxxU",
  authDomain: "yarreboardedwiki.firebaseapp.com",
  databaseURL: "https://yarreboardedwiki-default-rtdb.firebaseio.com",
  projectId: "yarreboardedwiki",
  storageBucket: "yarreboardedwiki.firebasestorage.app",
  messagingSenderId: "365304875142",
  appId: "1:365304875142:web:5d962e22c249917745a907",
  measurementId: "G-KCDR6CW19E"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser = null;
let isAdmin = false;

function showSection(sec) {
  document.querySelectorAll('#content > div').forEach(d=>d.classList.add('hidden'));
  document.getElementById(sec).classList.remove('hidden');
}

// --- Authentication ---
window.login = function() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  signInWithEmailAndPassword(auth,email,password)
  .then(userCredential=>{
    currentUser = userCredential.user;
    document.getElementById('kullaniciEmail').innerText = currentUser.email;
    document.getElementById('giris').classList.add('hidden');
    showSection('anasayfa');
    checkAdmin();
  })
  .catch(err=>{document.getElementById('girisMessage').innerText=err.message});
}

window.signup = function() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  createUserWithEmailAndPassword(auth,email,password)
  .then(userCredential=>{
    currentUser = userCredential.user;
    document.getElementById('kullaniciEmail').innerText = currentUser.email;
    document.getElementById('giris').classList.add('hidden');
    showSection('anasayfa');
  })
  .catch(err=>{document.getElementById('girisMessage').innerText=err.message});
}

window.logout = function() {
  signOut(auth).then(()=>{currentUser=null; showSection('giris');}).catch(err=>console.log(err));
}

// --- Admin Check ---
function checkAdmin() {
  // Sadece belirli email admin olsun
  isAdmin = currentUser.email === "selimhanlafci121@gmail.com";
  if(isAdmin) document.getElementById('admin').classList.remove('hidden');
}

// --- Base64 Helper ---
function fileToBase64(file, callback) {
  if(!file) { callback(null); return; }
  const reader = new FileReader();
  reader.onload = function(e){ callback(e.target.result); }
  reader.readAsDataURL(file);
}

// --- CRUD Kargolar ---
function loadKargolar() {
  const kargoList = document.getElementById('kargoList');
  kargoList.innerHTML='';
  onValue(ref(db,'kargolar'),snapshot=>{
    kargoList.innerHTML='';
    snapshot.forEach(snap=>{
      const k = snap.val();
      const div = document.createElement('div'); div.className='kargo';
      div.innerHTML=`<strong>${k.ad}</strong><br>Can: ${k.can}<br>Açıklama: ${k.aciklama}`;
      if(k.resim) div.innerHTML += `<img src="${k.resim}">`;
      if(isAdmin){
        const delBtn=document.createElement('button');
        delBtn.innerText='Sil';
        delBtn.onclick=()=>{ remove(ref(db,'kargolar/'+snap.key)); };
        div.appendChild(delBtn);
      }
      kargoList.appendChild(div);
    });
  });
}

window.addKargo = function(){
  if(!isAdmin) return alert('Sadece admin ekleyebilir!');
  const ad=document.getElementById('kargoAdi').value;
  const can=document.getElementById('kargoCan').value;
  const aciklama=document.getElementById('kargoAciklama').value;
  const file=document.getElementById('kargoResim').files[0];
  fileToBase64(file,(resim)=>{
    push(ref(db,'kargolar'),{ad,can,aciklama,resim});
  });
}

// --- CRUD Blocklar ---
function loadBlocklar() {
  const list = document.getElementById('blockList'); list.innerHTML='';
  onValue(ref(db,'blocklar'),snapshot=>{
    list.innerHTML='';
    snapshot.forEach(snap=>{
      const b = snap.val();
      const div=document.createElement('div'); div.className='block';
      div.innerHTML=`<strong>${b.ad}</strong><br>Can: ${b.can}<br>Hasar: ${b.hasar}<br>Açıklama: ${b.aciklama}`;
      if(b.resim) div.innerHTML+=`<img src="${b.resim}">`;
      if(isAdmin){
        const delBtn=document.createElement('button'); delBtn.innerText='Sil';
        delBtn.onclick=()=>{ remove(ref(db,'blocklar/'+snap.key)); };
        div.appendChild(delBtn);
      }
      list.appendChild(div);
    });
  });
}

window.addBlock = function(){
  if(!isAdmin) return alert('Sadece admin ekleyebilir!');
  const ad=document.getElementById('blockAdi').value;
  const can=document.getElementById('blockCan').value;
  const hasar=document.getElementById('blockHasar').value;
  const aciklama=document.getElementById('blockAciklama').value;
  const file=document.getElementById('blockResim').files[0];
  fileToBase64(file,(resim)=>{
    push(ref(db,'blocklar'),{ad,can,hasar,aciklama,resim});
  });
}

// --- CRUD Map ---
function loadMap() {
  const list = document.getElementById('mapList'); list.innerHTML='';
  onValue(ref(db,'map'),snapshot=>{
    list.innerHTML='';
    snapshot.forEach(snap=>{
      const m = snap.val();
      const div=document.createElement('div'); div.className='map';
      div.innerHTML=`<strong>${m.ad}</strong><br>Açıklama: ${m.aciklama}`;
      if(m.resim) div.innerHTML+=`<img src="${m.resim}">`;
      if(isAdmin){
        const delBtn=document.createElement('button'); delBtn.innerText='Sil';
        delBtn.onclick=()=>{ remove(ref(db,'map/'+snap.key)); };
        div.appendChild(delBtn);
      }
      list.appendChild(div);
    });
  });
}

window.addMap = function(){
  if(!isAdmin) return alert('Sadece admin ekleyebilir!');
  const ad=document.getElementById('mapAdi').value;
  const aciklama=document.getElementById('mapAciklama').value;
  const file=document.getElementById('mapResim').files[0];
  fileToBase64(file,(resim)=>{
    push(ref(db,'map'),{ad,aciklama,resim});
  });
}

// --- CRUD Yorumlar ---
function loadYorumlar() {
  const list = document.getElementById('yorumList'); list.innerHTML='';
  onValue(ref(db,'yorumlar'),snapshot=>{
    list.innerHTML='';
    snapshot.forEach(snap=>{
      const y = snap.val();
      const div=document.createElement('div'); div.className='yorum';
      div.innerHTML=`<strong>${y.email}</strong>: ${y.text}`;
      if(isAdmin){
        const delBtn=document.createElement('button'); delBtn.innerText='Sil';
        delBtn.onclick=()=>{ remove(ref(db,'yorumlar/'+snap.key)); };
        div.appendChild(delBtn);
      }
      list.appendChild(div);
    });
  });
}

window.addYorum = function(){
  const text=document.getElementById('yorumText').value;
  if(!currentUser) return alert('Giriş yapın');
  push(ref(db,'yorumlar'),{text,email:currentUser.email});
  document.getElementById('yorumText').value='';
}

// --- Admin Form Toggle ---
window.toggleForms = function(){
  document.getElementById('kargoForm').classList.toggle('hidden');
  document.getElementById('blockForm').classList.toggle('hidden');
  document.getElementById('mapForm').classList.toggle('hidden');
}

// --- Initialize Loads ---
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user;
    document.getElementById('kullaniciEmail').innerText=currentUser.email;
    document.getElementById('giris').classList.add('hidden');
    showSection('anasayfa');
    checkAdmin();
    loadKargolar(); loadBlocklar(); loadMap(); loadYorumlar();
  } else {
    currentUser=null;
    showSection('giris');
  }
});
</script>

</body>
</html>
